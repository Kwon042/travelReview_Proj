<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>마이페이지</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/header.css">
    <link rel="stylesheet" href="/mypage.css">
    <link rel="stylesheet" href="/footer.css">
</head>
<body>
<header th:replace="~{layout/header :: navbarFragment}"></header>
<div class="container">
    <h2>기본 정보</h2>
    <table class="info-table">
        <tr>
            <td><strong>프로필 사진</strong></td>
            <td></td>
            <td class="text-end">
                <img th:src="${user.profileImageUrl}" alt="Profile Image" class="profile-image" onclick="openProfileImageModal()">
            </td>
        </tr>
        <tr>
            <td><strong>사용자 이름</strong></td>
            <td><span th:text="${user.username}"></span></td>
            <td></td>
        </tr>
        <tr>
            <td><strong>닉네임</strong></td>
            <td><span id="currentNickname" th:text="${user.nickname}"></span></td>
            <td class="text-end"><span class="action-button" onclick="openEditModal('nickname')">></span></td>
        </tr>
        <tr>
            <td><strong>이메일</strong></td>
            <td><span id="currentEmail" th:text="${user.email}"></span></td>
            <td class="text-end"><span class="action-button" onclick="openEditModal('email')">></span></td>
        </tr>
        <tr>
            <td><strong>비밀번호</strong></td>
            <td>**********</td>
            <td class="text-end"><span class="action-button" onclick="togglePasswordForm()">></span></td>
        </tr>
    </table>

    <h3>찜한 여행지 목록</h3>
    <ul id="favouritePlaces">
        <li>여행지 1</li>
        <li>여행지 2</li>
        <li>여행지 3</li>
    </ul>
    <button id="deleteAccountButton" class="btn btn-danger">회원 탈퇴</button>

    <!-- 프로필 이미지 업로드 모달 -->
    <div id="profileImageModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeProfileImageModal()">&times;</span>
            <h4>프로필 이미지 업로드</h4>
            <input type="file" id="profileImageInput" accept="image/*">
            <button onclick="uploadProfileImage()">업로드</button>
        </div>
    </div>

    <div id="changePasswordForm" style="display: none;">
        <form action="/mypage/change_password" method="POST">
            <label for="currentPassword">현재 비밀번호</label>
            <input type="password" id="currentPassword" name="currentPassword" required>

            <label for="newPassword">새 비밀번호</label>
            <input type="password" id="newPassword" name="newPassword" required>

            <label for="confirmPassword">새 비밀번호 확인</label>
            <input type="password" id="confirmPassword" name="confirmPassword" required>

            <button type="submit">비밀번호 변경</button>
        </form>
    </div>
    <!-- 사용자 정보 수정 모달 -->
    <div id="editModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h4>수정할 항목을 선택하세요.</h4>
            <div class="modal-body">
                <!-- 여기에 동적으로 내용 삽입되도록 설정 -->
                <button onclick="openProfileImageUpload()">프로필 이미지 변경</button>
                <button onclick="openNicknameEdit()">닉네임 수정</button>
                <button onclick="openPasswordChange()">비밀번호 변경</button>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/mypage.js"></script>
<script>
    const currentUserId = "${user.id}";
</script>
</body>
<footer th:replace="~{layout/footer}"></footer>
</html>